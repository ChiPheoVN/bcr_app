var bacaratConfig={removeTieResultInProcedure:!1},allowProcedures=["procedure1","procedure2","procedure3","procedure4","procedure5","procedure6","procedure7","procedure8"],winRate=[{guess:4,total:5,rate:72},{guess:3,total:5,rate:61},{guess:5,total:6,rate:76},{guess:4,total:6,rate:65},{guess:3,total:6,rate:55},{guess:6,total:7,rate:81},{guess:5,total:7,rate:70},{guess:4,total:7,rate:57},{guess:7,total:8,rate:79},{guess:6,total:8,rate:73},{guess:5,total:8,rate:62.5},{guess:4,total:8,rate:55}],winnerLog=[],cardArr=[{number:0,point:0,value:0,name:null},{number:1,point:1,value:-1,name:"A"},{number:2,point:2,value:1,name:2},{number:3,point:3,value:1,name:3},{number:4,point:4,value:1,name:4},{number:5,point:5,value:1,name:5},{number:6,point:6,value:1,name:6},{number:7,point:7,value:0,name:7},{number:8,point:8,value:0,name:8},{number:9,point:9,value:0,name:9},{number:10,point:0,value:-1,name:10},{number:11,point:0,value:-1,name:"J"},{number:12,point:0,value:-1,name:"Q"},{number:13,point:0,value:-1,name:"K"}],setCardNumber=8,totalValue=0,bacaratInit={setupSetCard:()=>{cardArr=cardArr.map(e=>(e.remain=4*setCardNumber,e))},initTableScoreBoard:()=>{$("table.table-score-board tbody tr").remove();let e=6,a=13;for(let t=0;t<e;t++){let e=$("<tr>");for(let r=0;r<a;r++){let n=$("<td>",{"data-phase":t*a+r});e.append(n)}$("table.table-score-board tbody").append(e)}},createRandomWinnerLog:()=>{let e=15,a=[1,2,3,4,5,6,7,8,9,10,"j","q","k",null];for(let t=0;t<e;t++){let e={p1:a[Math.floor(Math.random()*a.length)],p2:a[Math.floor(Math.random()*a.length)],p3:a[Math.floor(Math.random()*a.length)]},t={b1:a[Math.floor(Math.random()*a.length)],b2:a[Math.floor(Math.random()*a.length)],b3:a[Math.floor(Math.random()*a.length)]},r=bacaratHandle.calcCardPointCardGroup(e,t),n=r.pv,l=r.bv;if(n%=10,l%=10,bacaratHandle.addWinnerLog(n,l,e,t),bacaratHandle.setTemplateResultCardGroup(e,t,l,n),bacaratHandle.setScoreBoardTable(winnerLog),winnerLog.length>=7){let e=bacaratHandle.calcWinnerRate(winnerLog);bacaratHandle.setGuessTable(e)}}}},bacaratHandle={bacarat:function(){$(document).on("click",".btn-add-game-result",function(){let e="txt-card-input-",a={p1:$("table.table-card-input input."+e+"p1").val(),p2:$("table.table-card-input input."+e+"p2").val(),p3:$("table.table-card-input input."+e+"p3").val()},t={b1:$("table.table-card-input input."+e+"b1").val(),b2:$("table.table-card-input input."+e+"b2").val(),b3:$("table.table-card-input input."+e+"b3").val()};a.p1=""==a.p1?null:a.p1,a.p3=""==a.p2?null:a.p2,a.p3=""==a.p3?null:a.p3,t.b1=""==t.b1?null:t.b1,t.b2=""==t.b2?null:t.b2,t.b3=""==t.b3?null:t.b3,bacaratHandle.resetInputCardGroup(),totalValue+=bacaratHandle.calcValueCardGroup(a,t),bacaratHandle.calcRemainCardSetCardGroup(a,t);let r=bacaratHandle.calcCardPointCardGroup(a,t),n=r.pv,l=r.bv;if(n%=10,l%=10,bacaratHandle.addWinnerLog(n,l,a,t),bacaratHandle.setTemplateResultCardGroup(a,t,l,n),bacaratHandle.setScoreBoardTable(winnerLog),winnerLog.length>=7){let e=bacaratHandle.calcWinnerRate(winnerLog);bacaratHandle.setGuessTable(e)}}).on("click",".btn-reset-result",function(){winnerLog=[],$("table.table-game-result tbody tr:not(.tr-template-game-result)").remove(),bacaratHandle.setGuessTable(),bacaratInit.initTableScoreBoard(),bacaratHandle.resetInputCardGroup(),$('input.txt-card-input[data-card-input-index="1"]').focus()}).on("click",".btn-remove-previous-result",function(){if(winnerLog.pop(),bacaratHandle.setScoreBoardTable(winnerLog),winnerLog.length>=7){let e=bacaratHandle.calcWinnerRate(winnerLog);bacaratHandle.setGuessTable(e)}else bacaratHandle.setGuessTable(null);$("table.table-game-result tbody tr:last-child").remove(),$('input.txt-card-input[data-card-input-index="1"]').focus()}).on("hidden.bs.collapse","#collapseVirtualKeyboard",function(){bacaratHandle.virtualKeyboardMode(!1)}).on("shown.bs.collapse","#collapseVirtualKeyboard",function(){bacaratHandle.virtualKeyboardMode(!0)}).on("click","button.btn-virtual-card",function(){let e=$(this).text(),a=$("input.txt-card-input-focus"),t=$(a).data("card-input-index");$(a).val(e),parseInt(t)<6&&($('input.txt-card-input[data-card-input-index="'+(parseInt(t)+1)+'"]').focus(),console.log($('input.txt-card-input[data-card-input-index="'+(parseInt(t)+1)+'"]')))}).on("focus","input.txt-card-input",function(){$("input.txt-card-input").removeClass("txt-card-input-focus"),$(this).addClass("txt-card-input-focus")})},convertCardToPoint:e=>{if(null==e)return 0;let a=bacaratHandle.convertCardToNumberObject(e),t=cardArr.filter(e=>e.number==a)[0];return t.point},convertCardToValue:e=>{if(null==e)return 0;let a=bacaratHandle.convertCardToNumberObject(e),t=cardArr.filter(e=>e.number==a)[0];return t.value},calcRemainCardInTotalSet:e=>{let a=bacaratHandle.convertCardToNumberObject(e);return cardArr=cardArr.map(e=>(e.number==a&&(e.remain-=1),e))},convertCardToNumberObject:e=>{switch(isNaN(e)&&(e=e.toUpperCase()),e){case"A":return 1;case"J":return 11;case"Q":return 12;case"K":return 13;default:return parseInt(e)}},resetInputCardGroup:()=>{let e="txt-card-input-";$("table.table-card-input input."+e+"p1").val(""),$("table.table-card-input input."+e+"p2").val(""),$("table.table-card-input input."+e+"p3").val(""),$("table.table-card-input input."+e+"b1").val(""),$("table.table-card-input input."+e+"b2").val(""),$("table.table-card-input input."+e+"b3").val("")},calcValueCardGroup:(e,a)=>bacaratHandle.convertCardToValue(e.p1)+bacaratHandle.convertCardToValue(e.p2)+bacaratHandle.convertCardToValue(e.p3)+bacaratHandle.convertCardToValue(a.b1)+bacaratHandle.convertCardToValue(a.b2)+bacaratHandle.convertCardToValue(a.b3),calcRemainCardSetCardGroup:(e,a)=>{bacaratHandle.calcRemainCardInTotalSet(e.p1),bacaratHandle.calcRemainCardInTotalSet(e.p2),bacaratHandle.calcRemainCardInTotalSet(e.p3),bacaratHandle.calcRemainCardInTotalSet(a.b1),bacaratHandle.calcRemainCardInTotalSet(a.b2),bacaratHandle.calcRemainCardInTotalSet(a.b3)},calcCardPointCardGroup:(e,a)=>{let t=bacaratHandle.convertCardToPoint(e.p1)+bacaratHandle.convertCardToPoint(e.p2)+bacaratHandle.convertCardToPoint(e.p3),r=bacaratHandle.convertCardToPoint(a.b1)+bacaratHandle.convertCardToPoint(a.b2)+bacaratHandle.convertCardToPoint(a.b3);return{pv:t,bv:r}},setTemplateResultCardGroup:(e,a,t,r)=>{let n=$("tr.tr-template-game-result.d-none").clone();n.removeClass("d-none").removeClass("tr-template-game-result").addClass("tr-result");let l=r>t?"Player":r<t?"Banker":"Tie";$(n).find("td.td-p1").text(null==e.p1?"":e.p1),$(n).find("td.td-p2").text(null==e.p2?"":e.p2),$(n).find("td.td-p3").text(null==e.p3?"":e.p3),$(n).find("td.td-b1").text(null==a.b1?"":a.b1),$(n).find("td.td-b2").text(null==a.b2?"":a.b2),$(n).find("td.td-b3").text(null==a.b3?"":a.b3),$(n).find("td.td-pv").text(r),$(n).find("td.td-bv").text(t),$(n).find("td.td-win").text(l),$("table.table-game-result tbody").append(n)},addWinnerLog:(e,a,t,r)=>{let n=e>a?"P":e<a?"B":"T",l=e>a?e:a,o={winner:n,score:l,player:t,banker:r,bv:a,pv:e};winnerLog.push(o),console.log(winnerLog)},setScoreBoardTable:e=>{bacaratInit.initTableScoreBoard(),e.map((e,a)=>{let t=null;"P"==e.winner?t="blue":"B"==e.winner?t="red":"T"==e.winner&&(t="green");let r=$('table.table-score-board tbody td[data-phase="'+a+'"]');$(r).text(e.score),$(r).css("background",t),$(r).css("color","#fff")})},setGuessTable:(e=null)=>{e?(e.color="P"==e.winner?"blue":"red",e.text="P"==e.winner?"Player":"Banker",$("table.table-guess").removeClass("d-none"),$("table.table-guess td.td-winner-color").css("background",e.color),$("table.table-guess td.td-winner-color").text(e.text),$("table.table-guess td.td-winner-percentage").text(e.rate+" %")):$("table.table-guess").addClass("d-none")},calcWinnerRate:e=>{let a=allowProcedures.map(a=>bacaratProcedure[a](e));a=a.filter(e=>null!=e),a=a.filter(e=>"T"!=e),console.log(a);let t=a.filter(e=>"P"==e).length,r=a.filter(e=>"B"==e).length,n=a.length,l=t>r?t:r,o=null;t>r?o="P":t<r?o="B":t==r&&(o=null!=a[6]?a[6]:a[1]);let d=winRate.filter(e=>e.guess==l&&e.total==n)[0];return d?{winner:o,rate:d.rate}:{winner:o,rate:"undefined"}},virtualKeyboardMode:(e=!0)=>{let a="txt-card-input-";e?($("table.table-card-input input."+a+"p1").attr("readonly",!0),$("table.table-card-input input."+a+"p2").attr("readonly",!0),$("table.table-card-input input."+a+"p3").attr("readonly",!0),$("table.table-card-input input."+a+"b1").attr("readonly",!0),$("table.table-card-input input."+a+"b2").attr("readonly",!0),$("table.table-card-input input."+a+"b3").attr("readonly",!0)):($("table.table-card-input input."+a+"p1").removeAttr("readonly"),$("table.table-card-input input."+a+"p2").removeAttr("readonly"),$("table.table-card-input input."+a+"p3").removeAttr("readonly"),$("table.table-card-input input."+a+"b1").removeAttr("readonly"),$("table.table-card-input input."+a+"b2").removeAttr("readonly"),$("table.table-card-input input."+a+"b3").removeAttr("readonly")),$('input.txt-card-input[data-card-input-index="1"]').focus()}},bacaratProcedure={procedure1:e=>{bacaratConfig.removeTieResultInProcedure&&(e=e.filter(e=>"T"!=e.winner));let a=7;a=e.length<a?e.length:a;let t=e.slice(-a),r=t.filter(e=>"P"==e.winner).length,n=t.filter(e=>"B"==e.winner).length;return r>n?"P":"B"},procedure2:e=>{if(bacaratConfig.removeTieResultInProcedure&&(e=e.filter(e=>"T"!=e.winner)),0==e.length)return null;let a=e[e.length-1];return"P"==a.winner?"B":"P"},procedure3:e=>{bacaratConfig.removeTieResultInProcedure&&(e=e.filter(e=>"T"!=e.winner));let a=e[e.length-1];return a.winner},procedure4:e=>{bacaratConfig.removeTieResultInProcedure&&(e=e.filter(e=>"T"!=e.winner));let a=7;if(e.length<a)return null;let t=e.slice(e.length-a,e.length-(a-1))[0];return t.winner},procedure5:e=>{bacaratConfig.removeTieResultInProcedure&&(e=e.filter(e=>"T"!=e.winner));let a=8;if(e.length<a)return null;let t=e.slice(e.length-a,e.length-(a-1))[0];return"P"==t.winner?"B":"P"},procedure6:e=>{let a=14,t=e.filter(e=>"P"==e.winner).length,r=e.filter(e=>"B"==e.winner).length,n=t/e.length*100,l=r/e.length*100;return n>l&&n-l>=a?"P":l>n&&l-n>=a?"B":null},procedure7:e=>{let a=3,t=e.slice(e.length-a),r=t.filter(e=>"P"==e.winner).length,n=t.filter(e=>"B"==e.winner).length;return r==a?"P":n==a?"B":null},procedure8:e=>{let a=4,t=e.slice(e.length-a),r=t.filter(e=>"P"==e.winner).length,n=t.filter(e=>"B"==e.winner).length;return r==a?"B":n==a?"P":null}};$(function(){bacaratInit.setupSetCard(),bacaratInit.initTableScoreBoard(),bacaratInit.createRandomWinnerLog(),bacaratHandle.bacarat()});