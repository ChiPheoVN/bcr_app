var bacaratConfig={removeTieResultInProcedure:!0,autoCreateRandomGameResult:!0,numberOfRandomGameResult:15},allowProcedures=["procedure1","procedure2","procedure3","procedure4","procedure5","procedure6","procedure7","procedure8"],winRate=[{guess:2,total:4,rate:{from:53,to:57}},{guess:3,total:4,rate:{from:61,to:65}},{guess:4,total:5,rate:{from:70,to:72}},{guess:3,total:5,rate:{from:59,to:63}},{guess:5,total:6,rate:{from:74,to:76}},{guess:4,total:6,rate:{from:63,to:67}},{guess:3,total:6,rate:{from:53,to:57}},{guess:6,total:7,rate:{from:72,to:74}},{guess:5,total:7,rate:{from:68,to:72}},{guess:4,total:7,rate:{from:55,to:59}},{guess:7,total:8,rate:{from:73,to:75}},{guess:6,total:8,rate:{from:71,to:73}},{guess:5,total:8,rate:{from:60.5,to:64.5}},{guess:4,total:8,rate:{from:53,to:57}}],winnerLog=[],cardArr=[{number:0,point:0,value:0,name:null},{number:1,point:1,value:-1,name:"A"},{number:2,point:2,value:1,name:2},{number:3,point:3,value:1,name:3},{number:4,point:4,value:1,name:4},{number:5,point:5,value:1,name:5},{number:6,point:6,value:1,name:6},{number:7,point:7,value:0,name:7},{number:8,point:8,value:0,name:8},{number:9,point:9,value:0,name:9},{number:10,point:0,value:-1,name:10},{number:11,point:0,value:-1,name:"J"},{number:12,point:0,value:-1,name:"Q"},{number:13,point:0,value:-1,name:"K"}],setCardNumber=8,totalValue=0,bacaratInit={setupSetCard:()=>{cardArr=cardArr.map(e=>(e.remain=4*setCardNumber,e))},initTableScoreBoard:()=>{$("table.table-score-board tbody tr").remove();let e=6,t=13;for(let a=0;a<e;a++){let r=$("<tr>");for(let n=0;n<t;n++){let t=$("<td>",{"data-phase":n*e+a});r.append(t)}$("table.table-score-board tbody").append(r)}},createRandomWinnerLog:()=>{let e=bacaratConfig.numberOfRandomGameResult,t=[1,2,3,4,5,6,7,8,9,10,"j","q","k",null];for(let a=0;a<e;a++){let e={p1:t[Math.floor(Math.random()*t.length)],p2:t[Math.floor(Math.random()*t.length)],p3:t[Math.floor(Math.random()*t.length)]},a={b1:t[Math.floor(Math.random()*t.length)],b2:t[Math.floor(Math.random()*t.length)],b3:t[Math.floor(Math.random()*t.length)]},r=bacaratHandle.calcCardPointCardGroup(e,a),n=r.pv,l=r.bv;if(n%=10,l%=10,bacaratHandle.addWinnerLog(n,l,e,a),bacaratHandle.setTemplateResultCardGroup(e,a,l,n),bacaratHandle.setScoreBoardTable(winnerLog),winnerLog.length>=7){let e=bacaratHandle.calcWinnerRate(winnerLog);bacaratHandle.setGuessTable(e)}}}},bacaratHandle={bacarat:function(){$(document).on("click",".btn-add-game-result",function(){let e="txt-card-input-",t={p1:$("table.table-card-input input."+e+"p1").val(),p2:$("table.table-card-input input."+e+"p2").val(),p3:$("table.table-card-input input."+e+"p3").val()},a={b1:$("table.table-card-input input."+e+"b1").val(),b2:$("table.table-card-input input."+e+"b2").val(),b3:$("table.table-card-input input."+e+"b3").val()};t.p1=""==t.p1?null:t.p1,t.p2=""==t.p2?null:t.p2,t.p3=""==t.p3?null:t.p3,a.b1=""==a.b1?null:a.b1,a.b2=""==a.b2?null:a.b2,a.b3=""==a.b3?null:a.b3,bacaratHandle.resetInputCardGroup(),totalValue+=bacaratHandle.calcValueCardGroup(t,a),bacaratHandle.calcRemainCardSetCardGroup(t,a);let r=bacaratHandle.calcCardPointCardGroup(t,a),n=r.pv,l=r.bv;if(n%=10,l%=10,bacaratHandle.addWinnerLog(n,l,t,a),bacaratHandle.setTemplateResultCardGroup(t,a,l,n),bacaratHandle.setScoreBoardTable(winnerLog),winnerLog.length>=7){let e=bacaratHandle.calcWinnerRate(winnerLog);bacaratHandle.setGuessTable(e)}$('input.txt-card-input[data-card-input-index="1"]').focus()}).on("click",".btn-reset-result",function(){winnerLog=[],$("table.table-game-result tbody tr:not(.tr-template-game-result)").remove(),bacaratHandle.setGuessTable(),bacaratInit.initTableScoreBoard(),bacaratHandle.resetInputCardGroup(),$('input.txt-card-input[data-card-input-index="1"]').focus()}).on("click",".btn-remove-previous-result",function(){if(winnerLog.pop(),bacaratHandle.setScoreBoardTable(winnerLog),winnerLog.length>=7){let e=bacaratHandle.calcWinnerRate(winnerLog);bacaratHandle.setGuessTable(e)}else bacaratHandle.setGuessTable(null);$("table.table-game-result tbody tr:last-child").remove(),$('input.txt-card-input[data-card-input-index="1"]').focus()}).on("hidden.bs.collapse","#collapseVirtualKeyboard",function(){bacaratHandle.virtualKeyboardMode(!1)}).on("shown.bs.collapse","#collapseVirtualKeyboard",function(){bacaratHandle.virtualKeyboardMode(!0)}).on("click","button.btn-virtual-card",function(){let e=$(this).text(),t=$("input.txt-card-input-focus"),a=$(t).data("card-input-index");$(t).val(e),parseInt(a)<6&&$('input.txt-card-input[data-card-input-index="'+(parseInt(a)+1)+'"]').focus()}).on("focus","input.txt-card-input",function(){$("input.txt-card-input").removeClass("txt-card-input-focus"),$(this).addClass("txt-card-input-focus")})},convertCardToPoint:e=>{if(null==e)return 0;let t=bacaratHandle.convertCardToNumberObject(e),a=cardArr.filter(e=>e.number==t)[0];return a.point},convertCardToValue:e=>{if(null==e)return 0;let t=bacaratHandle.convertCardToNumberObject(e),a=cardArr.filter(e=>e.number==t)[0];return a.value},calcRemainCardInTotalSet:e=>{let t=bacaratHandle.convertCardToNumberObject(e);return cardArr=cardArr.map(e=>(e.number==t&&(e.remain-=1),e))},convertCardToNumberObject:e=>{switch(isNaN(e)&&(e=e.toUpperCase()),e){case"A":return 1;case"J":return 11;case"Q":return 12;case"K":return 13;default:return parseInt(e)}},resetInputCardGroup:()=>{let e="txt-card-input-";$("table.table-card-input input."+e+"p1").val(""),$("table.table-card-input input."+e+"p2").val(""),$("table.table-card-input input."+e+"p3").val(""),$("table.table-card-input input."+e+"b1").val(""),$("table.table-card-input input."+e+"b2").val(""),$("table.table-card-input input."+e+"b3").val("")},calcValueCardGroup:(e,t)=>bacaratHandle.convertCardToValue(e.p1)+bacaratHandle.convertCardToValue(e.p2)+bacaratHandle.convertCardToValue(e.p3)+bacaratHandle.convertCardToValue(t.b1)+bacaratHandle.convertCardToValue(t.b2)+bacaratHandle.convertCardToValue(t.b3),calcRemainCardSetCardGroup:(e,t)=>{bacaratHandle.calcRemainCardInTotalSet(e.p1),bacaratHandle.calcRemainCardInTotalSet(e.p2),bacaratHandle.calcRemainCardInTotalSet(e.p3),bacaratHandle.calcRemainCardInTotalSet(t.b1),bacaratHandle.calcRemainCardInTotalSet(t.b2),bacaratHandle.calcRemainCardInTotalSet(t.b3)},calcCardPointCardGroup:(e,t)=>{let a=bacaratHandle.convertCardToPoint(e.p1)+bacaratHandle.convertCardToPoint(e.p2)+bacaratHandle.convertCardToPoint(e.p3),r=bacaratHandle.convertCardToPoint(t.b1)+bacaratHandle.convertCardToPoint(t.b2)+bacaratHandle.convertCardToPoint(t.b3);return{pv:a,bv:r}},setTemplateResultCardGroup:(e,t,a,r)=>{let n=$("tr.tr-template-game-result.d-none").clone();n.removeClass("d-none").removeClass("tr-template-game-result").addClass("tr-result");let l=r>a?"Player":r<a?"Banker":"Tie";$(n).find("td.td-p1").text(null==e.p1?"":e.p1),$(n).find("td.td-p2").text(null==e.p2?"":e.p2),$(n).find("td.td-p3").text(null==e.p3?"":e.p3),$(n).find("td.td-b1").text(null==t.b1?"":t.b1),$(n).find("td.td-b2").text(null==t.b2?"":t.b2),$(n).find("td.td-b3").text(null==t.b3?"":t.b3),$(n).find("td.td-pv").text(r),$(n).find("td.td-bv").text(a),$(n).find("td.td-win").text(l),$("table.table-game-result tbody").append(n)},addWinnerLog:(e,t,a,r)=>{let n=e>t?"P":e<t?"B":"T",l=e>t?e:t,o={winner:n,score:l,player:a,banker:r,bv:t,pv:e};winnerLog.push(o),console.log(winnerLog)},setScoreBoardTable:e=>{bacaratInit.initTableScoreBoard(),e.map((e,t)=>{let a=null;"P"==e.winner?a="blue":"B"==e.winner?a="red":"T"==e.winner&&(a="green");let r=$('table.table-score-board tbody td[data-phase="'+t+'"]');$(r).text(e.score),$(r).css("background",a),$(r).css("color","#fff")})},setGuessTable:(e=null)=>{e?(e.color="P"==e.winner?"blue":"red",e.text="P"==e.winner?"Player":"Banker",$("table.table-guess").removeClass("d-none"),$("table.table-guess td.td-winner-color").css("background",e.color),$("table.table-guess td.td-winner-color").text(e.text),$("table.table-guess td.td-winner-percentage").text(e.rate+" %")):$("table.table-guess").addClass("d-none")},calcWinnerRate:e=>{let t=allowProcedures.map(t=>bacaratProcedure[t](e));t=t.filter(e=>null!=e),t=t.filter(e=>"T"!=e),console.log(t);let a=t.filter(e=>"P"==e).length,r=t.filter(e=>"B"==e).length,n=t.length,l=a>r?a:r,o=null;a>r?o="P":a<r?o="B":a==r&&(o=null!=t[6]?t[6]:t[1]);let u=winRate.filter(e=>e.guess==l&&e.total==n)[0];return u?{winner:o,rate:(Math.random()*(u.rate.to-u.rate.from+1)+u.rate.from).toFixed(2)}:{winner:o,rate:"undefined"}},virtualKeyboardMode:(e=!0)=>{let t="txt-card-input-";e?($("table.table-card-input input."+t+"p1").attr("readonly",!0),$("table.table-card-input input."+t+"p2").attr("readonly",!0),$("table.table-card-input input."+t+"p3").attr("readonly",!0),$("table.table-card-input input."+t+"b1").attr("readonly",!0),$("table.table-card-input input."+t+"b2").attr("readonly",!0),$("table.table-card-input input."+t+"b3").attr("readonly",!0)):($("table.table-card-input input."+t+"p1").removeAttr("readonly"),$("table.table-card-input input."+t+"p2").removeAttr("readonly"),$("table.table-card-input input."+t+"p3").removeAttr("readonly"),$("table.table-card-input input."+t+"b1").removeAttr("readonly"),$("table.table-card-input input."+t+"b2").removeAttr("readonly"),$("table.table-card-input input."+t+"b3").removeAttr("readonly")),$('input.txt-card-input[data-card-input-index="1"]').focus()}},bacaratProcedure={procedure1:e=>{bacaratConfig.removeTieResultInProcedure&&(e=e.filter(e=>"T"!=e.winner));let t=7;t=e.length<t?e.length:t;let a=e.slice(-t),r=a.filter(e=>"P"==e.winner).length,n=a.filter(e=>"B"==e.winner).length;return r>n?"P":"B"},procedure2:e=>{if(bacaratConfig.removeTieResultInProcedure&&(e=e.filter(e=>"T"!=e.winner)),0==e.length)return null;let t=e[e.length-1];return"P"==t.winner?"B":"P"},procedure3:e=>{bacaratConfig.removeTieResultInProcedure&&(e=e.filter(e=>"T"!=e.winner));let t=e[e.length-1];return t.winner},procedure4:e=>{bacaratConfig.removeTieResultInProcedure&&(e=e.filter(e=>"T"!=e.winner));let t=7;if(e.length<t)return null;let a=e.slice(e.length-t,e.length-(t-1))[0];return a.winner},procedure5:e=>{bacaratConfig.removeTieResultInProcedure&&(e=e.filter(e=>"T"!=e.winner));let t=8;if(e.length<t)return null;let a=e.slice(e.length-t,e.length-(t-1))[0];return"P"==a.winner?"B":"P"},procedure6:e=>{let t=14,a=e.filter(e=>"P"==e.winner).length,r=e.filter(e=>"B"==e.winner).length,n=a/e.length*100,l=r/e.length*100;return n>l&&n-l>=t?"P":l>n&&l-n>=t?"B":null},procedure7:e=>{let t=3,a=e.slice(e.length-t),r=a.filter(e=>"P"==e.winner).length,n=a.filter(e=>"B"==e.winner).length;return r==t?"P":n==t?"B":null},procedure8:e=>{let t=4,a=e.slice(e.length-t),r=a.filter(e=>"P"==e.winner).length,n=a.filter(e=>"B"==e.winner).length;return r==t?"B":n==t?"P":null}};$(function(){bacaratInit.setupSetCard(),bacaratInit.initTableScoreBoard(),bacaratConfig.autoCreateRandomGameResult&&bacaratInit.createRandomWinnerLog(),bacaratHandle.bacarat()});